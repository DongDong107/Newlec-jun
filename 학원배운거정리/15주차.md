# 15주차 정리 (2023-03-06 ~ 03-10)

## 03.06

1. 오늘도 이전까지 내용들 요약정리 시작.

2. 추후에 참고해서 노션에 하나씩 차곡차곡 정리하고 외우자.

3. 트랜잭션을 처리하는 방법 => 스프링에서는 AOP라는 방법론을 이용.

4. Mybatis

- DAO를 구현하지 않게 만들어주고, SQL문만 작정하도록 도와주는 프레임워크

- 라이브러리 준비
- 구현할 Dao 인터페이스 준비
- Dao 인터페이스에 SQL 매핑하기

5. 인터페이스에 SQL 매핑방법

(1) 어노테이션

- id가 문자열이면? '' 이 포함되어야 함 #을 사용하면 '' 이 맞게 들어감.
- $ 는? 본래 값 그대로

- 어노테이션 매핑보다는 XML 매핑을 선호하게 된다.
- 쿼리문이 길어지고,

- Dao, Repository 파일에서는 쿼리매핑 ㄴㄴ. 약속들만.

(2) XML

- mapper 관련 xml 파일이 최근까지도 package 안에 있었다.
- 스프링부트가 버전이 올라가면서 리소스 폴더를 만들어주면서 여기에 두었는데 나중에 없다면 entity 패키지에 있을 가능성이 농후.

- 쓰는 방법

```XML
<!--> namespace에 Dao 파일의 위치<-->
<mapper namespace="kr.co.rland.web.repository.MenuRepository">
	<!-- 내려쓰기 쌉가능 -->
  <select id="findAll">
		select *
		from menu
		where id=#{id}
	</select>
  <!-- id에 약속한 구현할 메소드 이름 -->
	<select id="findById"></select>
	<insert id="insert"></insert>
	<update id="update"></update>
	<delete id="delete"></delete>
</mapper>
```

```XML
<!-- resultType 에 담을 그릇 개체 파일을 지정해주어야 함. -->
<select id="findAll" resultType="kr.co.rland.web.entity.Menu">
		select *
		from menu
	</select>
```

- 멥퍼 파일 경로 지정

```yml
mybatis:
  mapper-locations:
    # 전체 클래스패스 경로에서 / 앞에 모든 이름이 붙든 끝에 Mapper 가 달린 모든 파일
    - classpath*:mapper/*Mapper.xml
```

6. 우리가 현재 MenuRepository 파일에 mybatis 어노테이션을 해놓고 나면 스프링이 뻗음.

- JdbcMenu레포 파일에서 구현한 것도 어노테이션을 통해 IOC 컨테이너에 같이 중복으로 올라가 있기 떄문에.

7. application.properties , profile 관련 복습 필수

8. yml 공백 하나하나 다 약속임. ㅈ..지울예쩡..?

- plus1. 리플렉션, 어노테이션

## 03-07

1. mybatis는 오버로드 지원 안함.

2. @Mapper 를 했지만 마이바티스가 가지고 있는 컨테이너가 따로 있어서 예전에는 스프링 컨테이너와 같이 쓸 수 없었다.

3. 아쉬운 쪽인 마이바티스가 커넥션을 만들었다.

4. 오버로드를 구현하려면 오버로드로 넣는 값에 기본 값을 넣어서 원래 메소드를 구현하도록..

5. 페이저를 제대로 지원하려면 어떡해야 할까?

6. offset : 어디에서 부터

7. null 인지 확인할 수 있는 자료형으로 => Integer

- 앞으로 db를 다루다보면 null인지 아닌지 확인해야 하는 경우가 많아지므로 int형 보다는 Integer 형을 고려해야한다는 점을 주기적으로 생각해야 한다.

8. 오라클을 쓸 지는 모르겠지만 ROWNUM을 아주 비효율적으로 얻음.

9. mysql 같은 것에서는 offset를 이용해서 효율적으로 얻을 수 있음.

10. 구절의 맨 마지막에. Limit, Offset

```sql
select *
from menu
order by regDate desc
-- limit : 한 페이지에 나올 양, offset : 시작 위치.
limit 10 offset 0;
```

11. null 처리를 java로 지저분하게 했는데 mybatis가 지원해준다.

12. 처음 테이블 => 업데이트 시 필요한 컬럼 하나씩 추가 => 거대화 => 새로 리팩토링 => 무한 순환...

13. 자주 사용하는 매개변수를 위로, 아닌 것은 아래로 정리.

14. trim : SQL 문을 적을 때 조건문에서 앞 뒤 문장들이 적용이 되지 않아서 이어주는 and나 or 또는 ,(쉼표) 등이 남아있게 되면 자동으로 지워준다. (WHERE 나 SET 까지도)

- prefixOverrides : 실행될 쿼리의 <trim> 문 안에 쿼리 가장 **앞**에 해당하는 문자들이 있으면 자동으로 지워준다.

- suffixOverrides : 실행될 쿼리의 <trim> 문 안에 쿼리 가장 **뒤**에 해당하는 문자들이 있으면 자동으로 지워준다.

```sql
-- prefix 뒤의 절이 없으면 where 사라지고, And 나 or 이 바로 와버려도 제거해줌
<trim prefix="WHERE" prefixOverrides="AND |OR ">
			<if test="query != null">
				name like '%${query}%'
			</if>
			<if test="query != null">
				and price > #{price}
			</if>
			<if test="query != null">
				and categoryId = #{categoryId}
			</if>
</trim>
```

15. 로깅

16. update를 할 때 골때린데, null 로 한 행만 업데이트하려다가 다 null 이 되는걸 방지하려면 죄다 if문 처리를 하게되는데 이걸? 또 해결해줌.

17. <set>

18. JUnit

- 간단하게 테스트 해볼 수 있다.
- http://mybatis.org/spring-boot-starter/mybatis-spring-boot-test-autoconfigure/

0.  resultType, parameterType in XML

## 03-08

1. 통합 테스트 : 모든 걸 다 구현하고 테스트 해보는 것.

- 비효율적.

2. 파라미터 타입을 안써주면
   써줄 거면 하나만.

3. 로그를 꼼꼼히 출력해보자.

4. mybatis는 컬렉션으로 전달해주는 기능도 있다.

5. foreach

6. 컬럼 별칭 맵핑하기

- mybatis의 ResultMap 이용하기

7.

- 오라클은 모든 칼럼 대문자
- MS-SQL은 대소문자 구별
- mysql : 대소문자 구분 안됨.

8. mybatis - Dynamic SQL

- if, trim, foreach

9. @Mapper 를 인터페이스에서 치워야 할 때가 가끔 있다.

- 온전한 인터페이스로 두고 싶을 때
- 오버로드 하고 싶을 때.

10. 맨 땅 자바로 할 때는?

11. mybatis가 구현한 친구들이 있는 보따리 이름 : sqlSessionFactory

12. 저 팩토리와 맵핑되어서 스프링이 사용할 수 있도록 모아둔 콩자루 이름 : Mapper 컨테이너 (이 설명은 부정확함.)

- 11번, 12번 : Mapper 컨테이너, sqlSessionFactory와의 관계

13. IoC Container의 실제 자료형은 ApplicationContext

14. sqlSession만 꺼내서 연결해서 쓰는 방법이 있음.

15. 세션 : 기간.
    클라이언트가 필요로하는데 그 필요로 하는 기간이라는 개념이 생기면 클라이언트가 곧 클라이언트 세션이라는 말로 표현될 수 있다.

16.

- 맵퍼 객체를 사용하는 방법
- 팩토리에서 직접 꺼내쓰는 방법

17. 필요한 세션동안 팩토리에서 생성해서 멥퍼 컨테이너에 담아둠.

18. 오버로드 해서 사용하는 방법.
